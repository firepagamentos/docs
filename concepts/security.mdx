---
title: 'Seguran√ßa'
description: 'Pr√°ticas essenciais de seguran√ßa para integra√ß√£o com a API FireBanking'
---

## Vis√£o Geral

A seguran√ßa √© fundamental em APIs de pagamento. A FireBanking implementa m√∫ltiplas camadas de prote√ß√£o, mas sua aplica√ß√£o tamb√©m deve seguir pr√°ticas adequadas para garantir a seguran√ßa completa da integra√ß√£o.

<CardGroup cols={2}>
  <Card title="Autentica√ß√£o Segura" icon="key">
    Proteja suas chaves de API e configure autentica√ß√£o adequada
  </Card>
  <Card title="Comunica√ß√£o Criptografada" icon="shield">
    Use sempre HTTPS e valide certificados SSL/TLS
  </Card>
  <Card title="Valida√ß√£o de Webhooks" icon="webhook">
    Verifique a autenticidade das notifica√ß√µes recebidas
  </Card>
  <Card title="Prote√ß√£o de Dados" icon="lock">
    Gerencie dados sens√≠veis conforme regulamenta√ß√µes
  </Card>
</CardGroup>

## Autentica√ß√£o de API

### Gerenciamento de Chaves

#### Chaves de API Seguras

<AccordionGroup>
  <Accordion title="Armazenamento Seguro">
    **‚ùå Nunca fa√ßa:**
    - Hardcode chaves no c√≥digo fonte
    - Commit chaves no Git/reposit√≥rio
    - Exponha chaves em logs ou error reports
    - Compartilhe chaves por email/chat

    **‚úÖ Fa√ßa sempre:**
    - Use vari√°veis de ambiente
    - Armazene em servi√ßos de secrets (AWS Secrets Manager, Azure Key Vault)
    - Configure acesso restrito √†s chaves
    - Monitore uso das chaves
  </Accordion>

  <Accordion title="Rota√ß√£o de Chaves">
    **Periodicidade recomendada:**
    - **Produ√ß√£o**: A cada 6 meses
    - **Sandbox**: A cada 3 meses
    - **Imediata**: Em caso de suspeita de comprometimento

    **Processo de rota√ß√£o:**
    1. Gere nova chave no dashboard
    2. Atualize aplica√ß√£o (com fallback)
    3. Teste todas as funcionalidades
    4. Revogue chave antiga
    5. Monitore por 24h
  </Accordion>
</AccordionGroup>

### Configura√ß√£o de Ambientes

<CodeGroup>
```bash Vari√°veis de Ambiente
# Nunca no c√≥digo!
export FIREBANKING_API_KEY="fbk_prod_sua_chave_aqui"
export FIREBANKING_BASE_URL="https://api-gateway.firebanking.com.br/v1"
export FIREBANKING_WEBHOOK_SECRET="seu_webhook_secret_aqui"
```

```javascript Node.js - Configura√ß√£o Segura
// config/firebanking.js
const config = {
  apiKey: process.env.FIREBANKING_API_KEY,
  baseUrl: process.env.FIREBANKING_BASE_URL,
  webhookSecret: process.env.FIREBANKING_WEBHOOK_SECRET
};

// Valida√ß√£o de configura√ß√£o
if (!config.apiKey) {
  throw new Error('FIREBANKING_API_KEY √© obrigat√≥ria');
}

module.exports = config;
```

```python Python - Configura√ß√£o Segura
# config/settings.py
import os
from dataclasses import dataclass

@dataclass
class FireBankingConfig:
    api_key: str
    base_url: str
    webhook_secret: str

def load_config():
    config = FireBankingConfig(
        api_key=os.getenv('FIREBANKING_API_KEY'),
        base_url=os.getenv('FIREBANKING_BASE_URL'),
        webhook_secret=os.getenv('FIREBANKING_WEBHOOK_SECRET')
    )

    if not config.api_key:
        raise ValueError('FIREBANKING_API_KEY √© obrigat√≥ria')

    return config
```
</CodeGroup>

## Comunica√ß√£o Segura

### HTTPS Obrigat√≥rio

<Note>
  **Importante**: A API FireBanking **rejeita** conex√µes HTTP. Use sempre HTTPS para todas as requisi√ß√µes.
</Note>

#### Valida√ß√£o de Certificados

<CodeGroup>
```javascript JavaScript - Configura√ß√£o Segura
const https = require('https');

// ‚úÖ Configura√ß√£o correta
const agent = new https.Agent({
  rejectUnauthorized: true, // Valida certificado
  secureProtocol: 'TLSv1_2_method' // TLS 1.2+
});

const response = await fetch('https://api-gateway.firebanking.com.br/v1/payment', {
  method: 'POST',
  agent: agent,
  headers: {
    'x-api-key': process.env.FIREBANKING_API_KEY
  }
});
```

```python Python - Requests Seguro
import requests
import ssl

# ‚úÖ Configura√ß√£o correta
session = requests.Session()
session.verify = True  # Valida certificado SSL

# Configura√ß√£o TLS m√≠nima
context = ssl.create_default_context()
context.minimum_version = ssl.TLSVersion.TLSv1_2

response = session.post(
    'https://api-gateway.firebanking.com.br/v1/payment',
    headers={'x-api-key': os.getenv('FIREBANKING_API_KEY')},
    json=payment_data
)
```

```php PHP - cURL Seguro
<?php
// ‚úÖ Configura√ß√£o segura
$curl = curl_init();

curl_setopt_array($curl, [
    CURLOPT_URL => 'https://api-gateway.firebanking.com.br/v1/payment',
    CURLOPT_RETURNTRANSFER => true,
    CURLOPT_SSL_VERIFYPEER => true, // Valida certificado
    CURLOPT_SSL_VERIFYHOST => 2,    // Valida hostname
    CURLOPT_SSLVERSION => CURL_SSLVERSION_TLSv1_2, // TLS 1.2+
    CURLOPT_HTTPHEADER => [
        'x-api-key: ' . getenv('FIREBANKING_API_KEY'),
        'Content-Type: application/json'
    ]
]);

$response = curl_exec($curl);
?>
```
</CodeGroup>

## Valida√ß√£o de Webhooks

### Verifica√ß√£o de Assinatura

Para garantir que webhooks v√™m realmente da FireBanking:

<CodeGroup>
```javascript Node.js - Valida√ß√£o de Webhook
const crypto = require('crypto');

function validateWebhook(payload, signature, secret) {
  // Gera assinatura esperada
  const expectedSignature = crypto
    .createHmac('sha256', secret)
    .update(payload, 'utf8')
    .digest('hex');

  const expectedHeader = `sha256=${expectedSignature}`;

  // Compara√ß√£o segura
  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expectedHeader)
  );
}

// Express middleware
app.post('/webhooks/firebanking', (req, res) => {
  const signature = req.headers['x-firebanking-signature'];
  const payload = JSON.stringify(req.body);

  if (!validateWebhook(payload, signature, process.env.WEBHOOK_SECRET)) {
    return res.status(401).send('Invalid signature');
  }

  // Processar webhook...
  res.status(200).send('OK');
});
```

```python Python - Valida√ß√£o de Webhook
import hmac
import hashlib

def validate_webhook(payload: bytes, signature: str, secret: str) -> bool:
    """Valida assinatura do webhook"""
    expected_signature = hmac.new(
        secret.encode('utf-8'),
        payload,
        hashlib.sha256
    ).hexdigest()

    expected_header = f"sha256={expected_signature}"

    # Compara√ß√£o segura contra timing attacks
    return hmac.compare_digest(signature, expected_header)

# Flask example
@app.route('/webhooks/firebanking', methods=['POST'])
def handle_webhook():
    signature = request.headers.get('X-Firebanking-Signature')
    payload = request.get_data()

    if not validate_webhook(payload, signature, os.getenv('WEBHOOK_SECRET')):
        abort(401, 'Invalid signature')

    # Processar webhook...
    return 'OK', 200
```

```php PHP - Valida√ß√£o de Webhook
<?php
function validateWebhook($payload, $signature, $secret) {
    $expectedSignature = hash_hmac('sha256', $payload, $secret);
    $expectedHeader = "sha256=" . $expectedSignature;

    // Compara√ß√£o segura
    return hash_equals($signature, $expectedHeader);
}

// Processar webhook
$payload = file_get_contents('php://input');
$signature = $_SERVER['HTTP_X_FIREBANKING_SIGNATURE'] ?? '';
$secret = getenv('WEBHOOK_SECRET');

if (!validateWebhook($payload, $signature, $secret)) {
    http_response_code(401);
    exit('Invalid signature');
}

// Processar webhook...
http_response_code(200);
echo 'OK';
?>
```
</CodeGroup>

### Configura√ß√£o de Endpoints

<AccordionGroup>
  <Accordion title="URLs Seguras">
    **‚úÖ URLs recomendadas:**
    - `https://api.empresa.com/webhooks/firebanking`
    - `https://empresa.com/api/webhooks/payments`
    - `https://secure.empresa.com/notifications`

    **‚ùå Evite:**
    - URLs com par√¢metros expostos
    - Subdom√≠nios n√£o certificados
    - Endpoints em HTTP
  </Accordion>

  <Accordion title="Rate Limiting">
    Configure prote√ß√£o contra spam:
    ```javascript
    const rateLimit = require('express-rate-limit');

    const webhookLimiter = rateLimit({
      windowMs: 15 * 60 * 1000, // 15 minutos
      max: 100, // m√°ximo 100 requests por IP
      message: 'Muitas tentativas de webhook'
    });

    app.use('/webhooks', webhookLimiter);
    ```
  </Accordion>
</AccordionGroup>

## Prote√ß√£o de Dados Sens√≠veis

### Dados de Cart√£o

<Note>
  **PCI-DSS**: Nunca armazene dados completos de cart√£o em seu sistema. Use nossa tokeniza√ß√£o.
</Note>

#### O Que NUNCA Armazenar

```json Dados Proibidos
{
  "‚ùå NUNCA SALVE": {
    "card_number": "5555555555554444",
    "security_code": "123",
    "full_track_data": "qualquer trilha magn√©tica"
  }
}
```

#### O Que PODE Armazenar

```json Dados Permitidos
{
  "‚úÖ PODE SALVAR": {
    "token": "fbk_token_abc123",
    "last_four_digits": "4444",
    "brand": "visa",
    "expiration_month": 12,
    "expiration_year": 2025,
    "holder_name": "Jo√£o Silva"
  }
}
```

### Logs Seguros

#### Configura√ß√£o de Logs

<CodeGroup>
```javascript JavaScript - Log Seguro
const winston = require('winston');

// Filtro para remover dados sens√≠veis
const sensitiveDataFilter = winston.format((info) => {
  // Remove campos sens√≠veis
  const sensitiveFields = ['card_number', 'security_code', 'api_key'];

  sensitiveFields.forEach(field => {
    if (info[field]) {
      info[field] = '[FILTERED]';
    }
  });

  return info;
});

const logger = winston.createLogger({
  format: winston.format.combine(
    sensitiveDataFilter(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'app.log' })
  ]
});
```

```python Python - Log Seguro
import logging
import re

class SensitiveDataFilter(logging.Filter):
    def filter(self, record):
        # Padr√µes para filtrar
        patterns = [
            r'card_number["\']:\s*["\'][^"\']*["\']',
            r'security_code["\']:\s*["\'][^"\']*["\']',
            r'api_key["\']:\s*["\'][^"\']*["\']'
        ]

        message = str(record.getMessage())
        for pattern in patterns:
            message = re.sub(pattern, '[FILTERED]', message)

        record.msg = message
        return True

# Configurar logger
logger = logging.getLogger(__name__)
logger.addFilter(SensitiveDataFilter())
```
</CodeGroup>

## Monitoramento de Seguran√ßa

### Alertas Recomendados

<AccordionGroup>
  <Accordion title="Tentativas de Acesso Suspeitas">
    **Configure alertas para:**
    - M√∫ltiplas tentativas com chave inv√°lida
    - Requests de IPs n√£o autorizados
    - Padr√µes an√¥malos de tr√°fego
    - Webhooks com assinatura inv√°lida

    ```javascript
    // Exemplo de monitoramento
    let invalidAttempts = 0;

    app.use((req, res, next) => {
      const apiKey = req.headers['x-api-key'];

      if (!isValidApiKey(apiKey)) {
        invalidAttempts++;

        if (invalidAttempts > 10) {
          // Alerta de seguran√ßa
          sendSecurityAlert({
            type: 'INVALID_API_KEY_ATTEMPTS',
            ip: req.ip,
            count: invalidAttempts
          });
        }

        return res.status(401).send('Unauthorized');
      }

      next();
    });
    ```
  </Accordion>

  <Accordion title="Anomalias de Transa√ß√£o">
    **Monitore:**
    - Volume anormal de transa√ß√µes
    - Tentativas de transa√ß√µes com valores suspeitos
    - M√∫ltiplas tentativas de pagamento em pouco tempo
    - Padr√µes de teste suspeitos
  </Accordion>
</AccordionGroup>

### Auditoria e Compliance

#### Logs de Auditoria

```json Exemplo de Log Estruturado
{
  "timestamp": "2024-01-15T10:30:00Z",
  "event_type": "payment_created",
  "user_id": "user_123",
  "transaction_id": "txn_abc456",
  "amount": 100.00,
  "payment_method": "credit_card",
  "ip_address": "192.168.1.100",
  "user_agent": "MyApp/1.0",
  "result": "success"
}
```

#### Reten√ß√£o de Dados

| Tipo de Dado | Tempo de Reten√ß√£o |
|---------------|-------------------|
| **Logs de transa√ß√£o** | 7 anos |
| **Logs de acesso** | 1 ano |
| **Dados de webhook** | 6 meses |
| **Logs de erro** | 2 anos |

## Checklist de Seguran√ßa

### Desenvolvimento

- [ ] Chaves de API em vari√°veis de ambiente
- [ ] Valida√ß√£o de webhooks implementada
- [ ] HTTPS obrigat√≥rio em produ√ß√£o
- [ ] Logs sem dados sens√≠veis
- [ ] Tratamento de erros sem exposi√ß√£o
- [ ] Rate limiting configurado

### Infraestrutura

- [ ] Certificados SSL/TLS v√°lidos
- [ ] Firewall configurado
- [ ] Monitoramento de seguran√ßa ativo
- [ ] Backup seguro de configura√ß√µes
- [ ] Acesso restrito aos servidores
- [ ] Rota√ß√£o de chaves agendada

### Compliance

- [ ] Pol√≠tica de privacidade atualizada
- [ ] Termos de uso adequados
- [ ] Processo de incident response
- [ ] Documenta√ß√£o de seguran√ßa
- [ ] Treinamento da equipe
- [ ] Auditoria de seguran√ßa realizada

## Incident Response

### Em Caso de Comprometimento

<Steps>
  <Step title="Conten√ß√£o Imediata">
    1. Revogue chaves comprometidas
    2. Bloqueie IPs suspeitos
    3. Desative webhooks temporariamente
    4. Documente o incidente
  </Step>
  <Step title="Investiga√ß√£o">
    1. Analise logs de acesso
    2. Identifique escopo do problema
    3. Avalie impacto nos dados
    4. Colete evid√™ncias
  </Step>
  <Step title="Recupera√ß√£o">
    1. Gere novas chaves de API
    2. Atualize configura√ß√µes
    3. Reative servi√ßos gradualmente
    4. Monitore por anomalias
  </Step>
  <Step title="Comunica√ß√£o">
    1. Notifique stakeholders internos
    2. Comunique clientes se necess√°rio
    3. Documente li√ß√µes aprendidas
    4. Atualize processos de seguran√ßa
  </Step>
</Steps>

---

**üîí Lembre-se**: Seguran√ßa √© responsabilidade compartilhada. A FireBanking protege a infraestrutura, voc√™ protege sua aplica√ß√£o.