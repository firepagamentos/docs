---
title: 'Webhooks de Transferência'
description: 'Configure notificações em tempo real para transferências PIX (cash out)'
---

## Visão Geral

Os webhooks de PIX Cash Out notificam seu sistema em tempo real sobre o status das transferências PIX realizadas, permitindo que você acompanhe e processe as operações de saque com eficiência.

<Info>
  Os webhooks de cash out seguem o mesmo padrão de segurança dos webhooks de cash in.
</Info>

## Status dos Webhooks

### WITHDRAW_REQUEST
Transferência PIX foi iniciada e está sendo processada pelo provedor.

### WITHDRAW_PAID
Transferência PIX foi executada com sucesso. Valor debitado da conta.

### REFUND_IN
Estorno de PIX enviado. Valor previamente cobrado foi devolvido para conta de origem.

### ERROR
Transferência PIX falhou durante o processamento. Valor não foi debitado.

## Payload dos Webhooks

### Transferência Concluída (Status: WITHDRAW_PAID)

```json
{
  "transactionId": "withdraw-abc123-def456-ghi789",
  "businessTransactionId": "transfer-789012",
  "status": "WITHDRAW_PAID",
  "value": 25050,
  "movementType": "DEBIT",
  "endToEndId": "E00416968202401151530150123456789",
  "pixKey": "usuario@email.com",
  "createdDate": "2024-01-15T15:30:15.123Z",
  "ReceiverBankAccount": "123456",
  "ReceiverToBankAccountDigit": "7",
  "ReceiverBankBranch": "0001",
  "ReceiverBankCode": "077",
  "ReceiverDocumentNumber": "12345678901",
  "ReceiverBankName": "BANCO INTER S.A.",
  "ReceiverBankISPB": "00416968",
  "ReceiverName": "ANA SILVA SANTOS",
  "PayerBankAccount": "567890",
  "PayerBankAccountDigit": "1",
  "PayerBankBranch": "0001",
  "PayerBankCode": "077",
  "PayerDocumentNumber": "45438750000188",
  "PayerBankName": "BANCO INTER S.A.",
  "PayerBankISPB": "00416968",
  "PayerName": "MINHA EMPRESA LTDA",
  "VoucherUrl": "https://voucher.firebanking.com/withdraw/withdraw-abc123-def456-ghi789.pdf"
}
```

### Transferência com Erro (Status: ERROR)

```json
{
  "transactionId": "error-withdraw-123456789",
  "businessTransactionId": "transfer-erro-789012",
  "status": "ERROR",
  "value": 25050,
  "movementType": null,
  "endToEndId": null,
  "pixKey": "usuario-invalido@email.com",
  "createdDate": "2024-01-15T15:30:15.123Z",
  "ReceiverBankAccount": null,
  "ReceiverToBankAccountDigit": null,
  "ReceiverBankBranch": null,
  "ReceiverBankCode": null,
  "ReceiverDocumentNumber": null,
  "ReceiverBankName": null,
  "ReceiverBankISPB": null,
  "ReceiverName": null,
  "PayerBankAccount": null,
  "PayerBankAccountDigit": null,
  "PayerBankBranch": null,
  "PayerBankCode": null,
  "PayerDocumentNumber": null,
  "PayerBankName": null,
  "PayerBankISPB": null,
  "PayerName": null,
  "VoucherUrl": null
}
```

### Estorno Enviado (Status: REFUND_IN)

```json
{
  "transactionId": "8f7e6d5c-4b3a-2918-7654-3210fedcba98",
  "businessTransactionId": "estorno-pedido-12345",
  "status": "REFUND_IN",
  "value": 15000,
  "movementType": "DEBIT",
  "endToEndId": "E00000000202401151700300987654321",
  "pixKey": "joao@email.com",
  "createdDate": "2024-01-15T17:00:30.123Z",
  "ReceiverBankAccount": "123456",
  "ReceiverToBankAccountDigit": "7",
  "ReceiverBankBranch": "0001",
  "ReceiverBankCode": "001",
  "ReceiverDocumentNumber": "12345678901",
  "ReceiverBankName": "BANCO DO BRASIL S.A.",
  "ReceiverBankISPB": "00000000",
  "ReceiverName": "JOAO COSTA SILVA",
  "PayerBankAccount": "567890",
  "PayerBankAccountDigit": "1",
  "PayerBankBranch": "0001",
  "PayerBankCode": "077",
  "PayerDocumentNumber": "45438750000188",
  "PayerBankName": "BANCO INTER S.A.",
  "PayerBankISPB": "00416968",
  "PayerName": "MINHA EMPRESA LTDA",
  "VoucherUrl": "https://voucher.firebanking.com/refund/8f7e6d5c-4b3a-2918-7654-3210fedcba98.pdf"
}
```

### Transferência Solicitada (Status: WITHDRAW_REQUEST)

```json
{
  "transactionId": "pending-qr-789012345",
  "businessTransactionId": "qr-transfer-001",
  "status": "WITHDRAW_REQUEST",
  "value": 15000,
  "movementType": "DEBIT",
  "endToEndId": null,
  "pixKey": "00020101021226830014br.gov.bcb.pix2584",
  "createdDate": "2024-01-15T16:45:05.123Z",
  "ReceiverBankAccount": "456789",
  "ReceiverToBankAccountDigit": "0",
  "ReceiverBankBranch": "0001",
  "ReceiverBankCode": "001",
  "ReceiverDocumentNumber": "98765432100",
  "ReceiverBankName": "BANCO DO BRASIL S.A.",
  "ReceiverBankISPB": "00000000",
  "ReceiverName": "MARIA SANTOS",
  "PayerBankAccount": "567890",
  "PayerBankAccountDigit": "1",
  "PayerBankBranch": "0001",
  "PayerBankCode": "077",
  "PayerDocumentNumber": "45438750000188",
  "PayerBankName": "BANCO INTER S.A.",
  "PayerBankISPB": "00416968",
  "PayerName": "MINHA EMPRESA LTDA",
  "VoucherUrl": null
}
```

## Implementação do Webhook

<CodeGroup>
```javascript Node.js - Processamento de Cash Out
app.post('/webhooks/pix-cashout', (req, res) => {
  const signature = req.headers['x-firebanking-signature'];
  const payload = req.body;
  
  if (!verifySignature(payload, signature)) {
    return res.status(401).send('Unauthorized');
  }
  
  const webhook = JSON.parse(payload);
  
  switch (webhook.operation.status) {
    case 'WITHDRAW_REQUEST':
      handleWithdrawRequested(webhook);
      break;

    case 'WITHDRAW_PAID':
      handleWithdrawCompleted(webhook);
      break;

    case 'REFUND_IN':
      handleRefundSent(webhook);
      break;

    case 'ERROR':
      handleWithdrawFailed(webhook);
      break;
  }
  
  res.status(200).send('OK');
});

function handleWithdrawCompleted(transaction) {
  const valueBrl = transaction.operation.value / 100;
  const feeBrl = transaction.operation.fee / 100;
  const resultBrl = transaction.operation.result / 100;

  console.log(`Transferência PIX concluída: ${transaction.operation.externalID}`);
  console.log(`Beneficiário: ${transaction.receiver.fullName}`);
  console.log(`Valor: R$ ${valueBrl} (Taxa: R$ ${feeBrl}, Líquido: R$ ${resultBrl})`);
  console.log(`End-to-End ID: ${transaction.operation.additionalInfo.endToEndId}`);

  // Atualizar sistema interno
  updateTransferStatus(transaction.operation.externalID, 'completed');

  // Notificar usuário
  sendNotification({
    type: 'transfer_success',
    message: `Transferência PIX de R$ ${valueBrl} realizada com sucesso`,
    transaction_id: transaction.operation.externalID,
    endToEndId: transaction.operation.additionalInfo.endToEndId
  });
}

function handleWithdrawFailed(transaction) {
  const error = transaction.operation.error?.[0];
  const amountReturned = transaction.operation.additionalInfo?.amountReturned;

  console.log(`Transferência PIX falhou: ${transaction.operation.externalID}`);
  console.log(`Código do erro: ${error?.code}`);
  console.log(`Mensagem: ${error?.message}`);
  console.log(`Valor retornado: ${amountReturned ? 'Sim' : 'Não'}`);

  // Atualizar sistema interno
  updateTransferStatus(transaction.operation.externalID, 'failed', error);

  // Notificar usuário do erro
  sendNotification({
    type: 'transfer_error',
    message: `Erro na transferência PIX: ${error?.message}`,
    transaction_id: transaction.operation.externalID,
    error_code: error?.code,
    amount_returned: amountReturned
  });

  // Log para auditoria
  logTransferFailure({
    transactionId: transaction._id,
    businessId: transaction.businessId,
    errorCode: error?.code,
    errorMessage: error?.message
  });
}
```

```python Python - Análise de Transferências
@app.route('/webhooks/pix-cashout', methods=['POST'])
def webhook_pix_cashout():
    signature = request.headers.get('X-Firebanking-Signature')
    payload = request.get_data()
    
    if not verify_signature(payload, signature):
        abort(401)
    
    webhook = json.loads(payload)
    
    if webhook['operation']['status'] == 'WITHDRAW_REQUEST':
        handle_withdraw_requested(webhook)
    elif webhook['operation']['status'] == 'WITHDRAW_PAID':
        handle_withdraw_completed(webhook)
    elif webhook['operation']['status'] == 'REFUND_IN':
        handle_refund_sent(webhook)
    elif webhook['operation']['status'] == 'ERROR':
        handle_withdraw_failed(webhook)
    
    return 'OK', 200

def handle_withdraw_completed(transaction):
    operation = transaction['operation']
    receiver = transaction['receiver']

    # Registrar métricas
    record_metrics({
        'event': 'withdraw_success',
        'amount': operation['value'],
        'fee': operation['fee'],
        'result': operation['result'],
        'processing_time': calculate_processing_time(transaction),
        'provider': operation['provider'],
        'movement_type': operation['movementType']
    })

    # Atualizar contaábil
    update_accounting({
        'transaction_id': transaction['_id'],
        'business_id': transaction['businessId'],
        'type': 'debit',
        'amount': operation['value'],
        'fee': operation['fee'],
        'net_amount': operation['result'],
        'description': f"Transferência PIX - {operation['description']}"
    })

    # Gerar comprovante
    generate_receipt({
        'transaction_id': transaction['_id'],
        'beneficiary_name': receiver['fullName'],
        'beneficiary_document': receiver['document']['value'],
        'amount': operation['value'],
        'fee': operation['fee'],
        'net_amount': operation['result'],
        'end_to_end_id': operation['additionalInfo']['endToEndId']
    })

def handle_withdraw_failed(transaction):
    operation = transaction['operation']
    error = operation['error'][0] if operation.get('error') else {}
    amount_returned = operation.get('additionalInfo', {}).get('amountReturned', False)

    # Registrar falha para análise
    log_failure({
        'transaction_id': transaction['_id'],
        'business_id': transaction['businessId'],
        'external_id': operation.get('externalID'),
        'error_code': error.get('code'),
        'error_message': error.get('message'),
        'provider': operation['provider'],
        'amount': operation['value'],
        'amount_returned': amount_returned
    })

    # Se o valor foi retornado, registrar auditoria
    if amount_returned:
        log_balance_restoration({
            'business_id': transaction['businessId'],
            'amount': operation['value'],
            'reason': 'PIX transfer failed',
            'transaction_id': transaction['_id']
        })

    # Alertar equipe para erros críticos de chave PIX
    if error.get('code') == 'INVALID_PIX_KEY':
        send_alert({
            'type': 'pix_key_validation_error',
            'message': f"Chave PIX inválida: {operation.get('pixKey')}",
            'business_id': transaction['businessId'],
            'amount': operation['value'] / 100
        })
```
</CodeGroup>

## Categorias de Erro

### VALIDATION_ERROR
- **Descrição**: Erro de validação (chave PIX inválida, dados incorretos)
- **Ação**: Corrigir dados e tentar novamente
- **Valor retornado**: Sim

### INSUFFICIENT_BALANCE
- **Descrição**: Saldo insuficiente na conta
- **Ação**: Adicionar saldo e tentar novamente
- **Valor retornado**: Sim

### LIMIT_EXCEEDED
- **Descrição**: Limite de transferência excedido
- **Ação**: Aguardar próximo período ou ajustar limites
- **Valor retornado**: Sim

### TEMPORARY_ERROR
- **Descrição**: Erro temporário do sistema PIX
- **Ação**: Tentar novamente em alguns minutos
- **Valor retornado**: Sim

### CRITICAL_ERROR
- **Descrição**: Erro crítico que requer intervenção manual
- **Ação**: Contatar suporte
- **Valor retornado**: Varia

## Monitoramento de Transferências

### Métricas Importantes
```javascript
// Acompanhar performance das transferências
function trackWithdrawMetrics(data) {
  const metrics = {
    // Taxa de sucesso
    success_rate: calculateSuccessRate(),
    
    // Tempo médio de processamento
    avg_processing_time: calculateAvgProcessingTime(data),
    
    // Bancos mais utilizados
    top_banks: getTopBanks(data.beneficiary.bank),
    
    // Valores médios
    avg_amount: calculateAvgAmount(data.transaction.amount),
    
    // Tipos de erro mais comuns
    common_errors: getCommonErrors()
  };
  
  sendMetrics(metrics);
}
```

### Dashboard de Transferências
- **Volume diário**: Total de transferências por dia
- **Taxa de sucesso**: % de transferências bem-sucedidas
- **Tempo médio**: Tempo de processamento
- **Principais erros**: Tipos de erro mais frequentes
- **Distribuição por banco**: Transferências por instituição

## Casos de Uso

### Marketplace - Pagamento de Vendedores
```javascript
function handleWithdrawCompleted(data) {
  const vendorId = extractVendorId(data.metadata);
  const amount = data.transaction.amount;
  
  // Atualizar saldo do vendedor
  updateVendorBalance(vendorId, amount);
  
  // Notificar vendedor
  notifyVendor(vendorId, {
    type: 'payment_received',
    amount: amount,
    transaction_id: data.transaction.id
  });
  
  // Registrar para relatórios
  recordVendorPayment(vendorId, amount, data.transaction.processed_at);
}
```

### Sistema de Folha de Pagamento
```javascript
function handleWithdrawCompleted(data) {
  const employeeId = data.metadata.employee_id;
  const salaryAmount = data.transaction.amount;
  
  // Marcar salário como pago
  markSalaryAsPaid(employeeId, data.transaction.external_id);
  
  // Gerar comprovante de pagamento
  generateSalaryReceipt(employeeId, {
    amount: salaryAmount,
    date: data.transaction.processed_at,
    reference: data.transaction.external_id
  });
  
  // Enviar por email
  emailSalaryReceipt(employeeId);
}
```

### Plataforma de Serviços
```javascript
function handleWithdrawCompleted(data) {
  const serviceId = data.metadata.service_id;
  const providerId = data.metadata.provider_id;
  
  // Marcar serviço como pago
  updateServiceStatus(serviceId, 'paid');
  
  // Notificar prestador de serviço
  notifyServiceProvider(providerId, {
    service_id: serviceId,
    payment_amount: data.transaction.amount,
    payment_date: data.transaction.processed_at
  });
  
  // Atualizar rating/reputação
  updateProviderRating(providerId, serviceId);
}
```

## Recuperação de Falhas

### Retry Automático
```javascript
function handleWithdrawFailed(data) {
  const error = data.error;
  const transactionId = data.transaction.external_id;
  
  // Determinar se deve tentar novamente
  if (shouldRetry(error.category)) {
    const retryDelay = calculateRetryDelay(error.category);
    
    setTimeout(() => {
      retryTransfer(transactionId, {
        reason: error.message,
        attempt: getAttemptCount(transactionId) + 1
      });
    }, retryDelay);
  } else {
    // Erro permanente - notificar usuário
    notifyPermanentFailure(transactionId, error);
  }
}

function shouldRetry(errorCategory) {
  const retryableErrors = [
    'TEMPORARY_ERROR',
    'SYSTEM_UNAVAILABLE',
    'TIMEOUT_ERROR'
  ];
  return retryableErrors.includes(errorCategory);
}
```

## Boas Práticas

### Tratamento de Erros
- **Classifique erros**: Separe erros temporários de permanentes
- **Retry inteligente**: Apenas para erros recuperáveis
- **Alerta proativo**: Monitore taxa de erro
- **Backup manual**: Tenha processo manual para casos críticos

### Auditoria e Compliance
- **Log completo**: Registre todas as transferências
- **Rastrebilidade**: Mantenha End-to-End ID
- **Relatórios**: Gere relatórios regulares
- **Conciliação**: Compare com extratos bancários

### Performance
- **Processamento assíncrono**: Não bloqueie o webhook
- **Filas de trabalho**: Use filas para tarefas pesadas
- **Cache de dados**: Cache informações frequentes
- **Monitoramento**: Acompanhe tempo de resposta

## Próximos Passos

<CardGroup cols={2}>
  <Card title="Webhooks Cash In" href="/api-reference/pix/webhooks-cashin">
    Configure webhooks para cobranças PIX
  </Card>
  <Card title="Criar Transferência" href="/api-reference/pix/withdraw/create">
    Aprenda a criar transferências PIX
  </Card>
  <Card title="Dashboard" href="/dashboard/pix">
    Monitore suas transferências
  </Card>
</CardGroup>