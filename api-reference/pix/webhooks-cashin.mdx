---
title: 'Webhooks de Recebimento'
description: 'Configure notificações em tempo real para cobranças PIX (cash in)'
---

## Visão Geral

Os webhooks de PIX Cash In notificam seu sistema em tempo real sobre mudanças de status nas cobranças PIX, garantindo que você possa processar pedidos e atualizar sua aplicação imediatamente após os pagamentos.

<Info>
  Todos os webhooks são enviados via POST com payload JSON e assinatura de segurança.
</Info>

## Status dos Webhooks

### PAID
Transação PIX foi paga com sucesso pelo cliente. Valores creditados na conta.

### ERROR
Transação PIX falhou durante o processamento. Pode ocorrer por diversos motivos técnicos.

## Configuração

Configure a URL do webhook PIX através do endpoint de configuração de conta:

```bash cURL
curl --request POST \
  --url https://api-gateway.firebanking.com.br/v1/account/webhook \
  --header 'x-api-key: sua_chave_api' \
  --header 'Content-Type: application/json' \
  --data '{
    "pixWebhookUrl": "https://meusite.com.br/webhooks/pix"
  }'
```

<Info>
  Para configuração completa de webhooks, acesse a [documentação de configuração](/api-reference/webhooks/configure).
</Info>

## Payload dos Webhooks

### PIX Recebido (Status: PAID)

```json
{
  "transactionId": "03cadd36-fddd-4091-9ffe-67b0483cbcf5",
  "businessTransactionId": "pedido-12345",
  "status": "PAID",
  "value": 15000,
  "movementType": "CREDIT",
  "endToEndId": "E00000000202401151045300123456789",
  "pixKey": "joao@email.com",
  "createdDate": "2024-01-15T10:30:00.123Z",
  "ReceiverBankAccount": "567890",
  "ReceiverToBankAccountDigit": "1",
  "ReceiverBankBranch": "0001",
  "ReceiverBankCode": "077",
  "ReceiverDocumentNumber": "45438750000188",
  "ReceiverBankName": "BANCO INTER S.A.",
  "ReceiverBankISPB": "00416968",
  "ReceiverName": "MINHA EMPRESA LTDA",
  "PayerBankAccount": "123456",
  "PayerBankAccountDigit": "7",
  "PayerBankBranch": "0001",
  "PayerBankCode": "001",
  "PayerDocumentNumber": "12345678901",
  "PayerBankName": "BANCO DO BRASIL S.A.",
  "PayerBankISPB": "00000000",
  "PayerName": "JOAO COSTA SILVA",
  "VoucherUrl": "https://voucher.firebanking.com/pix/03cadd36-fddd-4091-9ffe-67b0483cbcf5.pdf"
}
```


### Transação com Erro (Status: ERROR)

```json
{
  "transactionId": "error-1234-5678-9abc-def012345678",
  "businessTransactionId": "pedido-erro-12345",
  "status": "ERROR",
  "value": 15000,
  "movementType": null,
  "endToEndId": null,
  "pixKey": "chave-invalida@email.com",
  "createdDate": "2024-01-15T14:30:45.123Z",
  "ReceiverBankAccount": null,
  "ReceiverToBankAccountDigit": null,
  "ReceiverBankBranch": null,
  "ReceiverBankCode": null,
  "ReceiverDocumentNumber": null,
  "ReceiverBankName": null,
  "ReceiverBankISPB": null,
  "ReceiverName": null,
  "PayerBankAccount": null,
  "PayerBankAccountDigit": null,
  "PayerBankBranch": null,
  "PayerBankCode": null,
  "PayerDocumentNumber": null,
  "PayerBankName": null,
  "PayerBankISPB": null,
  "PayerName": null,
  "VoucherUrl": null
}
```

## Campos da Transação

### Estrutura Principal

<ResponseField name="_id" type="string" required>
  ID único da transação (ObjectId)
</ResponseField>

<ResponseField name="businessId" type="string" required>
  ID do business que recebeu o PIX
</ResponseField>

<ResponseField name="operation" type="object" required>
  Dados da operação PIX
</ResponseField>

<ResponseField name="payer" type="object" required>
  Dados do pagador (cliente externo)
</ResponseField>

<ResponseField name="createdAt" type="string" required>
  Data de criação da transação (ISO 8601)
</ResponseField>

<ResponseField name="updatedAt" type="string" required>
  Data da última atualização (ISO 8601)
</ResponseField>

### Campo Operation

<ResponseField name="operation.type" type="string" required>
  Tipo da operação: `PAYMENT` ou `REFUND`
</ResponseField>

<ResponseField name="operation.method" type="string" required>
  Método: sempre `PIX`
</ResponseField>

<ResponseField name="operation.direction" type="string" required>
  Direção: sempre `IN` (recebimento)
</ResponseField>

<ResponseField name="operation.status" type="string" required>
  Status: `PAID` ou `ERROR`
</ResponseField>

<ResponseField name="operation.movementType" type="string" required>
  Tipo de movimento: `CREDIT` (entrada) ou `DEBIT` (saída)
</ResponseField>

<ResponseField name="operation.value" type="number" required>
  Valor original em centavos (R$ 150,00 = 15000)
</ResponseField>

<ResponseField name="operation.result" type="number" required>
  Valor efetivado em centavos
</ResponseField>

<ResponseField name="operation.fee" type="number" required>
  Taxa cobrada em centavos
</ResponseField>

<ResponseField name="operation.provider" type="string" required>
  Provedor utilizado: `CELCOIN`, `WOOVI`, etc.
</ResponseField>

<ResponseField name="operation.providerID" type="string" required>
  ID da transação no provedor
</ResponseField>

<ResponseField name="operation.externalID" type="string" optional>
  ID externo fornecido pelo cliente
</ResponseField>

<ResponseField name="operation.description" type="string" optional>
  Descrição da transação
</ResponseField>

<ResponseField name="operation.additionalInfo.endToEndId" type="string" required>
  ID end-to-end do PIX (BACEN)
</ResponseField>

## Implementação do Webhook

### Endpoint Receptor

<CodeGroup>
```javascript Node.js/Express
const express = require('express');
const crypto = require('crypto');
const app = express();

app.use(express.raw({ type: 'application/json' }));

app.post('/webhooks/pix', (req, res) => {
  const signature = req.headers['x-firebanking-signature'];
  const payload = req.body;
  
  // Verificar assinatura
  if (!verifySignature(payload, signature)) {
    return res.status(401).send('Unauthorized');
  }
  
  const webhook = JSON.parse(payload);
  
  switch (webhook.operation.status) {
    case 'PAID':
      handlePaymentReceived(webhook);
      break;

    case 'ERROR':
      handleTransactionError(webhook);
      break;
  }
  
  res.status(200).send('OK');
});

function verifySignature(payload, signature) {
  const secret = process.env.FIREBANKING_WEBHOOK_SECRET;
  const hash = crypto.createHmac('sha256', secret)
                    .update(payload)
                    .digest('hex');
  return signature === `sha256=${hash}`;
}

function handlePaymentReceived(transaction) {
  console.log(`PIX recebido: R$ ${transaction.operation.value / 100}`);
  console.log(`End-to-end ID: ${transaction.operation.additionalInfo.endToEndId}`);
  console.log(`Cliente: ${transaction.payer.fullName}`);

  // Processar pedido, enviar produto, etc.
  updateOrderStatus(transaction.operation.externalID, 'paid');
  sendConfirmationEmail(transaction.payer.fullName);
}

app.listen(3000);
```

```python Python/Flask
from flask import Flask, request, abort
import hashlib
import hmac
import json
import os

app = Flask(__name__)

@app.route('/webhooks/pix', methods=['POST'])
def webhook_pix():
    signature = request.headers.get('X-Firebanking-Signature')
    payload = request.get_data()
    
    # Verificar assinatura
    if not verify_signature(payload, signature):
        abort(401)
    
    webhook = json.loads(payload)
    
    if webhook['operation']['status'] == 'PAID':
        handle_payment_received(webhook)
    elif webhook['operation']['status'] == 'ERROR':
        handle_transaction_error(webhook)
    
    return 'OK', 200

def verify_signature(payload, signature):
    secret = os.getenv('FIREBANKING_WEBHOOK_SECRET')
    hash_obj = hmac.new(
        secret.encode('utf-8'),
        payload,
        hashlib.sha256
    )
    expected_signature = f"sha256={hash_obj.hexdigest()}"
    return signature == expected_signature

def handle_payment_received(transaction):
    value_brl = transaction['operation']['value'] / 100
    print(f"PIX recebido: R$ {value_brl}")
    print(f"End-to-end ID: {transaction['operation']['additionalInfo']['endToEndId']}")
    print(f"Cliente: {transaction['payer']['fullName']}")

    # Processar pedido
    update_order_status(transaction['operation']['externalID'], 'paid')

if __name__ == '__main__':
    app.run(port=3000)
```

```php PHP
<?php
header('Content-Type: application/json');

$signature = $_SERVER['HTTP_X_FIREBANKING_SIGNATURE'] ?? '';
$payload = file_get_contents('php://input');

// Verificar assinatura
if (!verifySignature($payload, $signature)) {
    http_response_code(401);
    exit('Unauthorized');
}

$webhook = json_decode($payload, true);

switch ($webhook['operation']['status']) {
    case 'PAID':
        handlePaymentReceived($webhook);
        break;
    case 'ERROR':
        handleTransactionError($webhook);
        break;
}

http_response_code(200);
echo 'OK';

function verifySignature($payload, $signature) {
    $secret = getenv('FIREBANKING_WEBHOOK_SECRET');
    $hash = 'sha256=' . hash_hmac('sha256', $payload, $secret);
    return hash_equals($signature, $hash);
}

function handlePaymentReceived($transaction) {
    $valueBrl = $transaction['operation']['value'] / 100;
    error_log("PIX recebido: R$ " . $valueBrl);
    error_log("End-to-end ID: " . $transaction['operation']['additionalInfo']['endToEndId']);
    error_log("Cliente: " . $transaction['payer']['fullName']);

    // Processar pedido
    updateOrderStatus($transaction['operation']['externalID'], 'paid');
}
?>
```
</CodeGroup>

## Segurança

### Verificação de Assinatura
Todos os webhooks incluem uma assinatura HMAC-SHA256 no header `X-Firebanking-Signature`:

```bash
X-Firebanking-Signature: sha256=a1b2c3d4e5f6...
```




## Testando Webhooks

### Ambiente de Desenvolvimento

Use ferramentas como ngrok para testar localmente:

```bash Terminal
# Expor localhost:3000
ngrok http 3000

# Configurar webhook PIX
curl -X POST https://api-gateway.firebanking.com.br/v1/account/webhook \
  -H 'x-api-key: sua_chave_api' \
  -H 'Content-Type: application/json' \
  -d '{"pixWebhookUrl": "https://abc123.ngrok.io/webhook"}'
```

<Info>
  Para informações completas sobre testes de webhooks, consulte a [documentação de configuração](/api-reference/webhooks/configure).
</Info>

## Monitoramento

### Dashboard de Webhooks
Acompanhe a saúde dos seus webhooks:
- Taxa de sucesso
- Tentativas de retry
- Webhooks falhados
- Tempo de resposta


## Boas Práticas

### Performance
- **Resposta rápida**: Retorne 200 imediatamente
- **Processamento assíncrono**: Use filas para tarefas demoradas
- **Cache de duplicatas**: Evite reprocessamento
- **Timeout adequado**: Configure timeout do servidor

### Confiabilidade
- **Valideção rigorosa**: Sempre verifique assinatura
- **Idempotência**: Trate webhooks duplicados
- **Retry manual**: Tenha processo para webhooks falhados
- **Monitoring**: Monitore taxas de sucesso

### Segurança
- **HTTPS obrigatório**: Nunca use HTTP
- **Validação de origem**: Confirme que vem da FireBanking
- **Log de segurança**: Registre tentativas de webhook
- **Secret seguro**: Mantenha webhook secret em variáveis de ambiente

## Próximos Passos

<CardGroup cols={2}>
  <Card title="Webhooks Cash Out" href="/api-reference/pix/webhooks-cashout">
    Configure webhooks para transferências PIX
  </Card>
  <Card title="Configurar Webhooks" href="/api-reference/webhooks/configure">
    Gerencie seus endpoints de webhook
  </Card>
  <Card title="Testar Webhooks" href="/api-reference/webhooks/test">
    Teste seus webhooks em sandbox
  </Card>
  <Card title="Monitorar Webhooks" href="/dashboard/webhooks">
    Acompanhe performance no dashboard
  </Card>
</CardGroup>