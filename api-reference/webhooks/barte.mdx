---
title: 'Webhook Específico Barte'
openapi: 'POST /webhooks/barte-a9b484fc-90a6-4255-9394-e3c1ca0633b9-webhook'
---

Receber notificações de webhook específicas para eventos do processador de pagamentos Barte. Este endpoint lida com eventos da integração da plataforma de pagamentos Barte.

## Autenticação

<Info>
  Este endpoint de webhook não requer cabeçalhos de autenticação. A segurança é fornecida através da URL única do webhook.
</Info>

## Formato da URL do Webhook

A URL do webhook contém um identificador único para segurança:
```
/webhooks/barte-{unique-id}-webhook
```

Cada conta de comerciante tem uma URL de webhook única que deve ser configurada em seu painel Barte.

## Tipos de Evento

Tipos de evento Barte comuns incluem:

<CardGroup cols={2}>
  <Card title="CHARGE_PAID" icon="circle-check">
    Pagamento foi completado com sucesso
  </Card>
  <Card title="CHARGE_FAILED" icon="circle-xmark">
    Processamento de pagamento falhou
  </Card>
  <Card title="CHARGE_CANCELLED" icon="circle-minus">
    Pagamento foi cancelado
  </Card>
  <Card title="CHARGE_REFUNDED" icon="arrow-rotate-left">
    Estorno foi processado
  </Card>
</CardGroup>

## Exemplo de Requisição de Webhook

```json Requisição de Webhook
{
  "eventType": "CHARGE_PAID",
  "timestamp": "2024-01-15T16:30:00Z",
  "data": {
    "chargeId": "barte_charge_12345",
    "orderId": "order_uuid_67890",
    "status": "PAID",
    "amount": 10000,
    "currency": "BRL",
    "paymentMethod": "credit_card",
    "customer": {
      "id": "customer_123",
      "email": "customer@example.com"
    },
    "card": {
      "maskedNumber": "****-****-****-1111",
      "brand": "visa",
      "lastFour": "1111"
    },
    "metadata": {
      "merchantOrderId": "ext-payment-12345",
      "customerIp": "192.168.1.100"
    }
  }
}
```

## Processamento de Webhook

### Resposta do Seu Endpoint

Seu endpoint de webhook deve:

1. **Retornar status 200** para confirmar o recebimento
2. **Processar rapidamente** (responder dentro de 10 segundos)
3. **Ser idempotente** (lidar com eventos duplicados graciosamente)
4. **Validar payload** (verificar tipo de evento e estrutura de dados)

```javascript Exemplo de Handler
app.post('/webhooks/barte-webhook', (req, res) => {
  const { eventType, data } = req.body;
  
  try {
    switch (eventType) {
      case 'CHARGE_PAID':
        handleChargeSuccess(data);
        break;
      case 'CHARGE_FAILED':
        handleChargeFailed(data);
        break;
      case 'CHARGE_REFUNDED':
        handleRefund(data);
        break;
      default:
        console.log(`Tipo de evento desconhecido: ${eventType}`);
    }
    
    res.status(200).json({ received: true });
  } catch (error) {
    console.error('Erro de processamento de webhook:', error);
    res.status(500).json({ error: 'Processamento falhou' });
  }
});
```

## Estrutura de Dados do Evento

### Evento CHARGE_PAID
```json
{
  "eventType": "CHARGE_PAID",
  "data": {
    "chargeId": "string",
    "orderId": "string",
    "status": "PAID",
    "amount": 10000,
    "processingFee": 300,
    "netAmount": 9700,
    "paidAt": "2024-01-15T16:30:00Z"
  }
}
```

### Evento CHARGE_FAILED
```json
{
  "eventType": "CHARGE_FAILED",
  "data": {
    "chargeId": "string",
    "orderId": "string",
    "status": "FAILED",
    "amount": 10000,
    "errorCode": "insufficient_funds",
    "errorMessage": "Fundos insuficientes no cartão",
    "failedAt": "2024-01-15T16:30:00Z"
  }
}
```

## Lógica de Retry

Se seu endpoint retorna um código de status não-2xx:

1. **Retry imediato** após 1 segundo
2. **Segundo retry** após 5 segundos  
3. **Terceiro retry** após 30 segundos
4. **Retry final** após 5 minutos

Após 4 tentativas falhadas, o webhook é marcado como falho e requer intervenção manual.

## Considerações de Segurança

<CardGroup cols={2}>
  <Card title="Segurança da URL" icon="lock">
    URL única do webhook fornece segurança através da obscuridade
  </Card>
  <Card title="Apenas HTTPS" icon="shield">
    Todas as chamadas de webhook usam criptografia HTTPS
  </Card>
  <Card title="Filtragem de IP" icon="filter">
    Considere filtrar requisições apenas de IPs do Barte
  </Card>
  <Card title="Validação de Requisição" icon="check">
    Valide estrutura do payload e campos obrigatórios
  </Card>
</CardGroup>

## Testando Webhooks

### Ngrok para Testes Locais
```bash
# Instalar e executar ngrok
ngrok http 3000

# Use a URL HTTPS para configuração do webhook
# https://abc123.ngrok.io/webhooks/barte-webhook
```

### Ferramentas de Teste de Webhook
- **Webhook.site** - Capturar e inspecionar webhooks
- **RequestBin** - Endpoints de webhook temporários
- **Postman** - Mock de requisições de webhook para teste

## Problemas Comuns

### Problemas de Timeout
- **Processamento lento** - Mover processamento pesado para jobs em background
- **Bloqueios de banco de dados** - Usar processamento assíncrono para atualizações de DB
- **Chamadas de API externa** - Evitar chamadas síncronas de API de terceiros

### Eventos Duplicados
```javascript Exemplo de Idempotência
const processedEvents = new Set();

app.post('/webhook', (req, res) => {
  const eventId = req.body.data.chargeId;
  
  if (processedEvents.has(eventId)) {
    return res.status(200).json({ already_processed: true });
  }
  
  // Processar evento
  processedEvents.add(eventId);
  res.status(200).json({ received: true });
});
```

## Monitoramento de Webhooks

Rastreie a saúde do webhook:
- **Tempos de resposta** - Monitore velocidade de processamento do webhook
- **Taxas de erro** - Alerte em altas taxas de falha
- **Volumes de evento** - Entenda padrões de tráfego
- **Atrasos de processamento** - Identifique gargalos

<Warning>
  Nunca exponha dados sensíveis em logs de webhook. Registre tipos de evento e IDs, mas não payloads completos.
</Warning>

## Configuração

Configure esta URL de webhook em seu painel de comerciante Barte:

1. **Navegar para** configurações de webhook no painel Barte
2. **Adicionar URL de webhook** com seu identificador único
3. **Selecionar eventos** que você deseja receber
4. **Testar configuração** usando ferramentas de teste do Barte
5. **Monitorar entrega** para garantir configuração adequada

<Tip>
  Use URLs de webhook diferentes para ambientes de produção e staging para evitar problemas entre ambientes.
</Tip>