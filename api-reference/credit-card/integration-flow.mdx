---
title: 'Fluxo de Integra√ß√£o - Cart√£o de Cr√©dito'
description: 'Guia completo do fluxo de integra√ß√£o para processar pagamentos com cart√£o de cr√©dito'
---

## Vis√£o Geral

Este guia apresenta o fluxo completo de integra√ß√£o para processar pagamentos com cart√£o de cr√©dito, desde a captura dos dados at√© a confirma√ß√£o da transa√ß√£o. O fluxo √© otimizado para convers√£o e seguran√ßa, garantindo uma experi√™ncia fluida para o usu√°rio final.

<Frame>
  <img
    className="block dark:hidden"
    src="/images/credit-card-flow.png"
    alt="Fluxo de Integra√ß√£o - Cart√£o de Cr√©dito"
  />
  <img
    className="hidden dark:block"
    src="/images/credit-card-flow-dark.png"
    alt="Fluxo de Integra√ß√£o - Cart√£o de Cr√©dito"
  />
</Frame>

## Fluxo Detalhado

### 1. Coleta de Dados do Cart√£o

Implemente um formul√°rio seguro para captura dos dados do cart√£o:

```html
<form id="payment-form">
  <!-- Dados do Cart√£o -->
  <div class="card-section">
    <label for="card-number">N√∫mero do Cart√£o</label>
    <input type="text" id="card-number" placeholder="1234 5678 9012 3456" maxlength="19">

    <div class="card-row">
      <div>
        <label for="expiry">Validade</label>
        <input type="text" id="expiry" placeholder="MM/AA" maxlength="5">
      </div>
      <div>
        <label for="cvv">CVV</label>
        <input type="text" id="cvv" placeholder="123" maxlength="4">
      </div>
    </div>

    <label for="holder-name">Nome no Cart√£o</label>
    <input type="text" id="holder-name" placeholder="Jo√£o Silva">
  </div>

  <!-- Dados do Comprador -->
  <div class="buyer-section">
    <label for="buyer-email">Email</label>
    <input type="email" id="buyer-email" placeholder="joao@email.com">

    <label for="buyer-document">CPF</label>
    <input type="text" id="buyer-document" placeholder="123.456.789-01">
  </div>

  <button type="submit">Finalizar Pagamento</button>
</form>
```

<Warning>
**Importante**: Nunca armazene dados de cart√£o no seu servidor. Sempre processe os dados diretamente atrav√©s da API FireBanking.
</Warning>

### 2. Valida√ß√£o Client-Side

Implemente valida√ß√µes b√°sicas antes de enviar para a API:

```javascript
function validateCardForm() {
  const cardNumber = document.getElementById('card-number').value.replace(/\s/g, '');
  const expiry = document.getElementById('expiry').value;
  const cvv = document.getElementById('cvv').value;
  const holderName = document.getElementById('holder-name').value;

  // Valida√ß√£o b√°sica do n√∫mero do cart√£o (algoritmo de Luhn)
  if (!isValidCardNumber(cardNumber)) {
    showError('N√∫mero do cart√£o inv√°lido');
    return false;
  }

  // Valida√ß√£o da validade
  if (!isValidExpiry(expiry)) {
    showError('Data de validade inv√°lida');
    return false;
  }

  // Valida√ß√£o CVV
  if (cvv.length < 3 || cvv.length > 4) {
    showError('CVV deve ter 3 ou 4 d√≠gitos');
    return false;
  }

  // Valida√ß√£o nome
  if (holderName.trim().length < 2) {
    showError('Nome do portador √© obrigat√≥rio');
    return false;
  }

  return true;
}

function isValidCardNumber(number) {
  let sum = 0;
  let isEven = false;

  for (let i = number.length - 1; i >= 0; i--) {
    let digit = parseInt(number[i]);

    if (isEven) {
      digit *= 2;
      if (digit > 9) {
        digit -= 9;
      }
    }

    sum += digit;
    isEven = !isEven;
  }

  return sum % 10 === 0;
}
```

### 3. Processamento da Transa√ß√£o

Envie os dados validados para a API FireBanking:

<CodeGroup>
```bash cURL
curl --request POST \
  --url https://api-gateway.firebanking.com.br/v1/credit-card \
  --header 'x-api-key: sua_chave_api' \
  --header 'Content-Type: application/json' \
  --data '{
    "externalId": "pedido-98765",
    "description": "Compra online - Produto XYZ",
    "amount": 299.90,
    "installments": 3,
    "card": {
      "number": "4111111111111111",
      "expirationMonth": "12",
      "expirationYear": "28",
      "cvv": "123",
      "holderName": "JOAO SILVA"
    },
    "buyer": {
      "name": "Jo√£o Silva",
      "email": "joao@email.com",
      "document": "12345678901"
    }
  }'
```

```javascript JavaScript
const processPayment = async (formData) => {
  try {
    showLoading(true);

    const response = await fetch('https://api-gateway.firebanking.com.br/v1/credit-card', {
      method: 'POST',
      headers: {
        'x-api-key': 'sua_chave_api',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        externalId: generateOrderId(),
        description: formData.description,
        amount: formData.amount,
        installments: formData.installments,
        card: {
          number: formData.cardNumber.replace(/\s/g, ''),
          expirationMonth: formData.expiry.split('/')[0],
          expirationYear: '20' + formData.expiry.split('/')[1],
          cvv: formData.cvv,
          holderName: formData.holderName.toUpperCase()
        },
        buyer: {
          name: formData.buyerName,
          email: formData.buyerEmail,
          document: formData.buyerDocument
        }
      })
    });

    const result = await response.json();

    if (response.ok) {
      handlePaymentSuccess(result);
    } else {
      handlePaymentError(result);
    }

  } catch (error) {
    handlePaymentError({ message: 'Erro de conex√£o. Tente novamente.' });
  } finally {
    showLoading(false);
  }
};
```

```python Python
import requests

def process_payment(payment_data):
    response = requests.post(
        'https://api-gateway.firebanking.com.br/v1/credit-card',
        headers={
            'x-api-key': 'sua_chave_api',
            'Content-Type': 'application/json'
        },
        json={
            "externalId": payment_data['external_id'],
            "description": payment_data['description'],
            "amount": payment_data['amount'],
            "installments": payment_data['installments'],
            "card": {
                "number": payment_data['card_number'],
                "expirationMonth": payment_data['expiry_month'],
                "expirationYear": payment_data['expiry_year'],
                "cvv": payment_data['cvv'],
                "holderName": payment_data['holder_name']
            },
            "buyer": {
                "name": payment_data['buyer_name'],
                "email": payment_data['buyer_email'],
                "document": payment_data['buyer_document']
            }
        }
    )

    return response.json()
```
</CodeGroup>

### 4. Resposta Inicial

A API retorna uma resposta inicial com o status da transa√ß√£o:

**Resposta de Sucesso:**
```json
{
  "id": "070ab63a-5849-4f1b-ad10-a67b9136711f",
  "externalId": "pedido-98765",
  "status": "PROCESSING",
  "description": "Compra online - Produto XYZ",
  "amount": 299.90,
  "installments": 3,
  "createdAt": "2025-07-31T19:31:02.737Z"
}
```

**Poss√≠veis Status Iniciais:**
- `PROCESSING` - Transa√ß√£o em an√°lise
- `PAID` - Aprovada imediatamente
- `DENIED` - Negada pelo emissor

### 5. Processamento pela Operadora

Durante esta etapa, a transa√ß√£o passa por valida√ß√µes:

- üîê **Autentica√ß√£o**: Verifica√ß√£o dos dados do cart√£o
- üí∞ **Autoriza√ß√£o**: Valida√ß√£o de limite e saldo
- üõ°Ô∏è **Antifraude**: An√°lise de risco da transa√ß√£o
- ‚è±Ô∏è **Tempo m√©dio**: 2-5 segundos para resposta

<Info>
O sistema realiza valida√ß√µes em tempo real com a operadora do cart√£o. Transa√ß√µes podem ser aprovadas instantaneamente ou passar por an√°lise adicional.
</Info>

### 6. Confirma√ß√£o Final

Com base na an√°lise, voc√™ receber√° um webhook com o resultado final:

**Transa√ß√£o Aprovada** - `PAID`:
```json
{
  "product": "CREDIT_CARD",
  "paymentId": "070ab63a-5849-4f1b-ad10-a67b9136711f",
  "externalId": "pedido-98765",
  "status": "PAID",
  "processedAt": "2025-07-31T19:31:02.737Z",
  "additionalInfo": {
    "purchaseTitle": "Compra online - Produto XYZ",
    "description": "Compra online - Produto XYZ",
    "amount": 299.90,
    "installments": 3,
    "chargeType": "FEE_TO_SELLER",
    "cardBrand": "visa",
    "cardLastDigits": "1111",
    "metadata": {
      "orderId": "pedido-98765",
      "customerId": "cust-123456"
    }
  }
}
```

**Transa√ß√£o Negada** - `DENIED`:
```json
{
  "product": "CREDIT_CARD",
  "paymentId": "070ab63a-5849-4f1b-ad10-a67b9136711f",
  "externalId": "pedido-98765",
  "status": "DENIED",
  "processedAt": "2025-07-31T19:31:02.737Z",
  "additionalInfo": {
    "purchaseTitle": "Compra online - Produto XYZ",
    "description": "Compra online - Produto XYZ",
    "amount": 299.90,
    "installments": 3,
    "cardBrand": "visa",
    "cardLastDigits": "1111",
    "denialReason": "Insufficient funds",
    "metadata": {
      "orderId": "pedido-98765"
    }
  }
}
```

## Estados da Transa√ß√£o

| Status | Descri√ß√£o | Pr√≥xima A√ß√£o |
|--------|-----------|---------------|
| `PROCESSING` | Transa√ß√£o em an√°lise | Aguardar webhook final |
| `PAID` | Pagamento aprovado | Liberar produto/servi√ßo |
| `DENIED` | Pagamento negado | Informar cliente e oferecer alternativa |
| `CANCELED` | Transa√ß√£o cancelada | Informar cancelamento |
| `REFUNDED` | Pagamento estornado | Processar reembolso |

## Interface de Usu√°rio

### Feedback Visual Durante o Processamento

```javascript
function handlePaymentProcess() {
  // Mostrar loading
  showLoadingState();

  // Processar pagamento
  processPayment(formData)
    .then(response => {
      if (response.status === 'PAID') {
        showSuccessMessage('Pagamento aprovado!');
        redirectToSuccess();
      } else if (response.status === 'PROCESSING') {
        showProcessingMessage('Processando pagamento...');
        waitForWebhook();
      } else if (response.status === 'DENIED') {
        showErrorMessage('Pagamento negado. Verifique os dados do cart√£o.');
        enableForm();
      }
    })
    .catch(error => {
      showErrorMessage('Erro no processamento. Tente novamente.');
      enableForm();
    });
}

function showLoadingState() {
  document.getElementById('submit-btn').disabled = true;
  document.getElementById('submit-btn').innerHTML =
    '<span class="spinner"></span> Processando...';
}

function showSuccessMessage(message) {
  document.getElementById('payment-status').innerHTML =
    `<div class="success-message">${message}</div>`;
}

function showErrorMessage(message) {
  document.getElementById('payment-status').innerHTML =
    `<div class="error-message">${message}</div>`;
}
```

### Tratamento de Erros Comuns

```javascript
function handlePaymentError(error) {
  const errorMessages = {
    'INVALID_CARD': 'N√∫mero do cart√£o inv√°lido',
    'EXPIRED_CARD': 'Cart√£o vencido',
    'INSUFFICIENT_FUNDS': 'Saldo insuficiente',
    'INVALID_CVV': 'CVV inv√°lido',
    'CARD_BLOCKED': 'Cart√£o bloqueado - entre em contato com seu banco',
    'GENERIC_ERROR': 'Erro no processamento - tente novamente'
  };

  const message = errorMessages[error.code] || errorMessages['GENERIC_ERROR'];
  showErrorMessage(message);

  // Sugerir alternativas
  if (error.code === 'INSUFFICIENT_FUNDS') {
    showAlternativePayments();
  }
}

function showAlternativePayments() {
  document.getElementById('alternatives').innerHTML = `
    <div class="alternatives">
      <h4>Outras formas de pagamento:</h4>
      <button onclick="showPixPayment()">Pagar com PIX</button>
      <button onclick="showBoletoPayment()">Gerar Boleto</button>
    </div>
  `;
}
```

## Implementa√ß√£o de Webhook

Configure um endpoint robusto para receber confirma√ß√µes:

```javascript
app.post('/webhooks/credit-card', express.raw({type: 'application/json'}), (req, res) => {
  try {
    const payload = JSON.parse(req.body);

    // Verificar assinatura
    if (!verifyWebhookSignature(req.headers, req.body)) {
      return res.status(401).send('Unauthorized');
    }

    // Processar baseado no status
    switch (payload.status) {
      case 'PAID':
        handlePaymentSuccess(payload);
        break;

      case 'DENIED':
        handlePaymentDenied(payload);
        break;

      case 'REFUNDED':
        handlePaymentRefunded(payload);
        break;
    }

    res.status(200).send('OK');
  } catch (error) {
    console.error('Webhook error:', error);
    res.status(500).send('Internal Server Error');
  }
});

function handlePaymentSuccess(payload) {
  // Liberar produto/servi√ßo
  fulfillOrder(payload.externalId);

  // Enviar confirma√ß√£o para cliente
  sendConfirmationEmail(payload);

  // Atualizar sistema interno
  updatePaymentStatus(payload.paymentId, 'completed');
}
```

## Seguran√ßa e Melhores Pr√°ticas

### Valida√ß√£o de Dados Sens√≠veis

```javascript
// M√°scara para n√∫mero do cart√£o
function formatCardNumber(value) {
  const v = value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
  const matches = v.match(/\d{4,16}/g);
  const match = matches && matches[0] || '';
  const parts = [];

  for (let i = 0, len = match.length; i < len; i += 4) {
    parts.push(match.substring(i, i + 4));
  }

  if (parts.length) {
    return parts.join(' ');
  } else {
    return v;
  }
}

// Valida√ß√£o CVV por bandeira
function validateCvv(cardNumber, cvv) {
  const brand = detectCardBrand(cardNumber);

  if (brand === 'amex') {
    return cvv.length === 4;
  } else {
    return cvv.length === 3;
  }
}
```

### Rate Limiting

```javascript
const rateLimit = require('express-rate-limit');

const paymentLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutos
  max: 5, // m√°ximo 5 tentativas por IP
  message: 'Muitas tentativas de pagamento. Tente novamente em 15 minutos.',
  standardHeaders: true,
  legacyHeaders: false
});

app.use('/api/credit-card', paymentLimiter);
```

## Monitoramento

Monitore m√©tricas importantes:

- üìä **Taxa de aprova√ß√£o**: PAID / Total de transa√ß√µes
- ‚è±Ô∏è **Tempo de resposta**: Tempo at√© confirma√ß√£o
- üö´ **Taxa de nega√ß√£o**: Por motivo de recusa
- üí≥ **Distribui√ß√£o por bandeira**: Visa, Mastercard, etc.
- üîÑ **Taxa de retry**: Tentativas ap√≥s nega√ß√£o

## Pr√≥ximos Passos

<CardGroup cols={2}>
  <Card title="API Reference - Criar Pagamento" href="/api-reference/credit-card/create">
    Documenta√ß√£o completa da API de cart√£o
  </Card>
  <Card title="Webhooks - Cart√£o de Cr√©dito" href="/api-reference/credit-card/webhooks">
    Implementar recebimento de confirma√ß√µes
  </Card>
  <Card title="Estornos - Cart√£o de Cr√©dito" href="/api-reference/credit-card/refund">
    Processar devolu√ß√µes de pagamento
  </Card>
  <Card title="Sandbox - Ambiente de Testes" href="/testing/sandbox">
    Teste sua integra√ß√£o com cart√µes fict√≠cios
  </Card>
</CardGroup>