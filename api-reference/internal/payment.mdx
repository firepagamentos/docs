---
title: 'Criar Pagamento Interno'
openapi: 'POST /internal/payment/{businessId}'
---

Criar pagamentos usando credenciais de API interna em nome de contas de negócio específicas. Este endpoint é para integrações sistema-a-sistema e requer autorização especial.

<Warning>
  Este é um endpoint de API interna apenas para sistemas autorizados. Ele contorna a autenticação normal de negócio para integrações de sistema.
</Warning>

## Autenticação

Este endpoint requer uma **Chave de API Interna** no cabeçalho da requisição:

```bash Autenticação
x-internal-token: SUA_CHAVE_API_INTERNA
```

## Parâmetros de Caminho

<ParamField path="businessId" type="string" required>
  O identificador único da conta de negócio para qual criar o pagamento
</ParamField>

## Corpo da Requisição

O corpo da requisição usa a mesma estrutura do endpoint padrão de criação de pagamento, suportando pagamentos com cartão e token.

## Exemplo de Requisição

```bash cURL
curl -X POST "https://api.firebanking.com/v1/internal/payment/business-id-456" \
  -H "x-internal-token: SUA_CHAVE_API_INTERNA" \
  -H "Content-Type: application/json" \
  -d '{
    "purchaseValue": 15000,
    "installments": 2,
    "externalId": "internal-payment-789",
    "purchaseTitle": "Pagamento Sistema Interno",
    "payment": {
      "chargeType": "CREDITO_PARCELADO_LOJA",
      "capture": true,
      "card": {
        "name": "Cliente Interno",
        "number": "4000000000000002",
        "expiration": "03/27",
        "securityCode": "789"
      }
    },
    "buyer": {
      "name": "Cliente Interno",
      "document": "11122233344",
      "email": "interno@example.com", 
      "phone": "11777777777",
      "countryCode": "+55",
      "address": {
        "country": "BR",
        "state": "MG",
        "city": "Belo Horizonte",
        "district": "Centro",
        "street": "Rua da Bahia",
        "zipCode": "30000000",
        "number": "789"
      }
    }
  }'
```

## Exemplo de Resposta

```json Resposta
{
  "id": "internal-payment-12345",
  "businessId": "business-id-456",
  "status": "processing",
  "amount": 15000,
  "installments": 2,
  "externalId": "internal-payment-789",
  "purchaseTitle": "Pagamento Sistema Interno",
  "chargeType": "CREDITO_PARCELADO_LOJA",
  "captured": true,
  "buyer": {
    "uuid": "buyer-uuid-internal-123",
    "name": "Cliente Interno",
    "email": "interno@example.com",
    "document": "11122233344"
  },
  "maskedCardNumber": "****-****-****-0002",
  "processingMethod": "internal_api",
  "createdAt": "2024-01-15T16:30:00Z",
  "metadata": {
    "internalApiVersion": "1.0",
    "processedBySystem": "internal-gateway"
  }
}
```

## Campos da Resposta

<ResponseField name="businessId" type="string">
  A conta de negócio que possui este pagamento
</ResponseField>

<ResponseField name="processingMethod" type="string">
  Indica que o pagamento foi criado via API interna
</ResponseField>

<ResponseField name="metadata.internalApiVersion" type="string">
  Versão da API interna usada para processamento
</ResponseField>

<ResponseField name="metadata.processedBySystem" type="string">
  Identificador do sistema interno que processou o pagamento
</ResponseField>

## Validação de Conta de Negócio

Antes do processamento, o sistema valida:

### Status da Conta
- Conta de negócio deve estar **ativa**
- Conta não deve estar **suspensa** ou **restrita**
- Conta deve ter **capacidades de processamento** válidas

### Limites da Conta
- Transação deve estar dentro dos **limites da conta**
- **Limites de volume** diário/mensal não devem ser excedidos
- **Scores de risco** devem estar dentro de intervalos aceitáveis

## Processamento de Pagamento

### Fluxo de Processamento

1. **Validar token interno** e permissões
2. **Verificar conta de negócio** status e limites
3. **Processar pagamento** usando configuração da conta de negócio
4. **Aplicar regras de negócio** e estruturas de taxa
5. **Retornar resposta** com metadados específicos do negócio

### Recursos Específicos do Negócio

- **Estruturas de taxa** aplicadas por configuração de negócio
- **Regras de risco** específicas por tipo de negócio
- **URLs de webhook** das configurações de negócio
- **Cronogramas de liquidação** por conta de negócio

## Casos de Uso

<CardGroup cols={2}>
  <Card title="Pagamentos de Plataforma" icon="layer-group">
    Plataforma criando pagamentos para vendedores de marketplace
  </Card>
  <Card title="Integração de Sistema" icon="plug">
    Sistemas ERP criando pagamentos automaticamente
  </Card>
  <Card title="Processamento em Lote" icon="list-check">
    Sistemas de processamento de pagamento em lote
  </Card>
  <Card title="Integração de Serviço" icon="gear">
    Serviços internos criando pagamentos programaticamente
  </Card>
</CardGroup>

## Cenários de Erro

### Token Interno Inválido
```json 401 Unauthorized
{
  "error": "Token interno inválido",
  "message": "Chave de API interna é inválida ou expirada"
}
```

### Negócio Não Encontrado
```json 404 Not Found
{
  "error": "Negócio não encontrado",
  "businessId": "invalid-business-123",
  "message": "Conta de negócio não existe"
}
```

### Conta de Negócio Suspensa
```json 403 Forbidden
{
  "error": "Conta suspensa",
  "businessId": "business-id-456",
  "message": "Conta de negócio está temporariamente suspensa"
}
```

### Permissões Insuficientes
```json 403 Forbidden
{
  "error": "Permissões insuficientes",
  "message": "Token interno não autorizado para este negócio"
}
```

### Limites da Conta Excedidos
```json 400 Bad Request
{
  "error": "Limite excedido", 
  "message": "Transação excede limites da conta de negócio",
  "limit": 100000,
  "requestedAmount": 150000
}
```

## Considerações de Segurança

<CardGroup cols={2}>
  <Card title="Segurança do Token" icon="key">
    Tokens internos têm privilégios elevados
  </Card>
  <Card title="Isolamento de Negócio" icon="shield">
    Pagamentos são isolados por conta de negócio
  </Card>
  <Card title="Log de Auditoria" icon="file-text">
    Todo uso da API interna é registrado e monitorado
  </Card>
  <Card title="Limitação de Taxa" icon="gauge">
    Limites de taxa rígidos previnem abuso
  </Card>
</CardGroup>

## Limitação de Taxa

A API interna tem limites maiores mas controlados:
- **100 requisições por minuto** por token interno
- **1000 requisições por hora** por token interno
- **10.000 requisições por dia** por token interno

## Monitoramento e Auditoria

### Trilha de Auditoria
Todas as chamadas da API interna são registradas com:
- **Identificador do token interno**
- **Conta de negócio afetada**
- **Detalhes do pagamento criado**
- **Timestamp e sistema de origem**
- **Resultados do processamento**

### Alertas de Monitoramento
- **Padrões de atividade incomuns**
- **Altas taxas de erro**
- **Tentativas de acesso não autorizadas**
- **Violações de limite de taxa**

## Melhores Práticas

1. **Armazenamento seguro de token** - Armazene tokens internos de forma segura
2. **Validação de negócio** - Sempre valide se o negócio existe e está ativo
3. **Tratamento de erros** - Implemente tratamento abrangente de erros
4. **Lógica de retry** - Trate falhas temporárias de forma graciosa
5. **Conformidade de auditoria** - Mantenha logs detalhados para conformidade
6. **Isolamento de testes** - Use tokens separados para testes

## Exemplo de Integração

```python Integração Python
import requests
import logging
from typing import Dict, Optional

class InternalPaymentClient:
    def __init__(self, internal_token: str, base_url: str):
        self.internal_token = internal_token
        self.base_url = base_url
        self.session = requests.Session()
        self.session.headers.update({
            'x-internal-token': internal_token,
            'Content-Type': 'application/json'
        })

    def create_payment(self, business_id: str, payment_data: Dict) -> Optional[Dict]:
        """Criar pagamento para conta de negócio específica"""
        url = f"{self.base_url}/internal/payment/{business_id}"
        
        try:
            response = self.session.post(url, json=payment_data, timeout=30)
            response.raise_for_status()
            
            payment = response.json()
            logging.info(f"Pagamento criado: {payment['id']} para negócio: {business_id}")
            return payment
            
        except requests.exceptions.HTTPError as e:
            error_data = e.response.json() if e.response else {}
            logging.error(f"Falha na criação do pagamento: {error_data}")
            raise
        except requests.exceptions.RequestException as e:
            logging.error(f"Erro de rede ao criar pagamento: {str(e)}")
            raise

    def validate_business(self, business_id: str) -> bool:
        """Verificar se a conta de negócio é válida e ativa"""
        # Implementação verificaria o status do negócio
        # Este é um placeholder para a lógica de validação real
        pass

# Uso
client = InternalPaymentClient('internal_token_123', 'https://api.firebanking.com/v1')

payment_data = {
    "purchaseValue": 15000,
    "installments": 1,
    "externalId": "internal-001",
    "payment": {
        "chargeType": "CREDITO_A_VISTA",
        "capture": True,
        "card": {
            "name": "Nome do Cliente",
            "number": "4000000000000002",
            "expiration": "12/25",
            "securityCode": "123"
        }
    },
    # ... resto dos dados de pagamento
}

try:
    payment = client.create_payment('business-123', payment_data)
    print(f"Pagamento criado: {payment['id']}")
except Exception as e:
    print(f"Falha ao criar pagamento: {e}")
```

<Tip>
  Tokens de API interna são emitidos apenas para sistemas autorizados. Entre em contato com nossa equipe técnica para solicitar acesso e obter credenciais adequadas.
</Tip>